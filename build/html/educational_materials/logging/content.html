<!DOCTYPE html>

<html lang="ru" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Логирование. Что это и в чем его польза? &#8212; документация toolchain 1.0</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=12dfc556" />
    <script src="../../_static/documentation_options.js?v=9ca2116e"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/translations.js?v=29b1f277"></script>
    <link rel="index" title="Алфавитный указатель" href="../../genindex.html" />
    <link rel="search" title="Поиск" href="../../search.html" />
    <link rel="next" title="Задача" href="exercises.html" />
    <link rel="prev" title="Вопросы" href="../testing/quiz.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="id1">
<h1>Логирование. Что это и в чем его польза?<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h1>
<p>Что значит логирование? Логирование (или журнал событий) является важным инструментом при разработке программного обеспечения. Логирование нужно нам для того, чтобы записать шаги и результат выполнения различных участков приложения для дальнейшего использования с целью анализа или поиска ошибок.</p>
<section id="id2">
<h2>Мотивация<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<p>При использовании логирования мы можем не гадать, что именно произошло в нашем приложении, а опереться на конкретную информацию. При этом нужно помнить, что переизбыток информации так же вреден, как и ее недостаток: в куче разнородных сообщений, часть из которых являются бесполезными, а часть избыточными, ошибку найти еще можно, а вот причины, которые к ней привели, уже гораздо сложнее. Речь идет о записи специального текстового файла (лога) с особым образом структурированной информацией о работе программы. Каждое сообщение может сопровождаться метками, самая простая из которых — метка времени, для удобного поиска и группировки.</p>
</section>
<section id="id3">
<h2>Зачем нужно логирование?<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h2>
<p>Инструменты для логирования можно рассматривать как отдельную систему при разработке ПО, при этом она не менее важна, чем, например, система контроля версий. При этом системами контроля версий принято пользоваться почти всегда, а системе логирования не уделяется достаточного внимания, так как ее поддержка в коде приложения (все это дополнительные строчки кода) не несет дополнительного функционала, если все идет по плану. Однако логи очень полезны. Если все пошло не так, как должно, и если их нет, единственный способ найти ошибку — работать с пользователем и воспроизводить проблему.</p>
<p>Существует несколько сценариев, в которых ведение логов необходимо:</p>
<ol class="arabic simple">
<li><p><strong>Отладка</strong>
Логи помогают разработчикам понимать и диагностировать проблемы в их ПО, предоставляя подробную информацию о том, что происходит внутри приложения. Особенно это полезно, когда приложение работает с данными от пользователей, когда невозможно предусмотреть все возможные ситуации заранее. Эта информация может быть использована для выявления и исправления ошибок. Всем знакомо подобное окно, когда происходит ошибка, которую не предусмотрел разработчик. В таком окне обычно есть кнопка «Сообщить о проблеме», если ее нажать, разработчику уйдет сообщение об ошибке и часть логов.</p></li>
</ol>
<p><img alt="error_report" src="../../_images/error_report.png" /></p>
<p><em>Примечание об ошибках, появление которых предусмотрено, можно сообщить текстом и предложить варианты исправления. Это можно тоже отправить в логи</em></p>
<p>Посмотреть когда-либо отправленные системой сообщения об ошибках на Ubuntu можно, выполнив команду в терминале:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>xdg-open<span class="w"> </span>https://errors.ubuntu.com/user/<span class="sb">`</span>sudo<span class="w"> </span>cat<span class="w"> </span>/var/lib/whoopsie/whoopsie-id<span class="sb">`</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p><strong>Мониторинг</strong>
Этот сценарий предполагает использование логов для выявления процессов, которые не связаны с ошибками, но могут означать другую проблему. Например, если нагрузка на сервер (число одновременных подключений) выросла в 10 раз за короткий промежуток времени. Возможно, происходит какая-то атака. Так логи могут использоваться для мониторинга работоспособности, а также для выявления потенциальных проблем. Логи также можно использовать для отслеживания состояния важных процессов, например, миграции базы данных или обновления системы.</p></li>
<li><p><strong>Proof of operation</strong>
В некоторых случаях ведение журнала логов просто необходимо для демонстрации работоспособности приложения и требуется в соответствии с нормативными актами или отраслевыми стандартами. Логи могут служить доказательством соответствия требованиям и использоваться для демонстрации того, что ПО работает согласно установленным политикам и процедурам.</p></li>
<li><p><strong>Аудит</strong>
Логи могут использоваться в целях аудита, чтобы помочь убедиться, что система используется правильно, а также для обнаружения и предотвращения несанкционированного доступа или неправильного использования. В данном случае мы можем хранить время входа в систему, локацию, откуда произведен вход, и, например, выяснить, не пользуется ли часть сотрудников ключами других.</p></li>
</ol>
</section>
<section id="id4">
<h2>Уровни логирования<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h2>
<p>Заниматься логированием необходимо с самого начала разработки, чтобы во время последующей эксплуатации мы могли собирать наиболее полную информацию о работе ПО. Даже при хорошо продуманном логировании в файлах-логах копится очень много информации. Чтобы систематизировать важную информацию и упростить ее последующее использование, существуют уровни логирования. Уровни логирования предусмотрены не только в качестве меток для поиска и выборки событий, но и используются самой библиотекой логирования для того, чтобы можно было оставить вывод только логов определенного уровня. Всего выделяют 5 основных:</p>
<ul class="simple">
<li><p><strong>Trace</strong>
Уровень <em>Trace</em> используется для регистрации самых мелких событий, которые позволят отследить каждый шаг алгоритма или другую подобную информацию. Как правило, это не требуется, поскольку алгоритмы обычно хорошо известны и покрываются тестами. Но если вам нужен очень подробный отчет по каждой строке кода, то вам сюда. Не забудьте запастись достаточным дисковым пространством для файлов-логов.</p></li>
<li><p><strong>Debug</strong>
Уровень <em>Debug</em> используется для регистрации подробной информации, которая в основном предназначена для разработчиков. Сообщения на этом уровне менее подробны, чем на <em>Trace</em>, но не настолько, чтобы быть полезны кому-то кроме разработчиков. Отладочные сообщения обычно используются на этапе разработки и тестирования, чтобы помочь понять, что происходит внутри системы. При сборке проекта для пользователей этот уровень отключают, и события уровня <em>Debug</em> не собираются на машинах пользователей.</p></li>
<li><p><strong>Info</strong>
Уровень <em>Info</em> используется для регистрации информации о нормальных, ожидаемых событиях. Информационные сообщения могут дать представление о поведении системы и использоваться в целях мониторинга. Например, так можно собирать количество подключений от пользователя за определенный промежуток времени, например, 1 час.</p></li>
<li><p><strong>Warning</strong>
Уровень <em>Warning</em> используется для регистрации необычных или неожиданных событий, но необязательно ошибок. Предупреждения могут указывать на потенциальные проблемы, которые необходимо устранить и которые уже могут привести к более серьезным последствиям. Например, падение скорости передачи данных ниже уровня, когда это начинает влиять на работу приложения.</p></li>
<li><p><strong>Error</strong>
Уровень <em>Error</em> используется для регистрации событий, которые представляют собой сбой или непредвиденную ситуацию. Сообщения об ошибках могут указывать на проблему, которую необходимо устранить, например, падение канала связи так, что данные пользователя вообще не будут передаваться.</p></li>
<li><p><strong>Fatal</strong>
Уровень <em>Fatal</em> используется для регистрации наиболее серьезных событий, таких как полный сбой системы или критическая проблема безопасности. Критические сообщения указывают на то, что требуется немедленное внимание для предотвращения или устранения серьезной проблемы. К таким событиям можно отнести получение файла с данными, у которого не сходится контрольная сумма, это может привести не только к неудобству пользователей, но и к потерям со стороны компании-разработчика.</p></li>
</ul>
<p>Благодаря разным уровням ведения журнала программное обеспечение для ведения журнала предоставляет способ фильтровать регистрируемые события, что облегчает фокусировку на наиболее важных событиях.</p>
</section>
<section id="id5">
<h2>Основы грамотного логирования<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h2>
<p>Чтобы получить файлы логирования, которые будут удобными в последующей работе, следует грамотно подойти к процессу их создания:</p>
<ul class="simple">
<li><p>Логировать все важные события, будь то запуск приложения, остановка или возобновление транзакций, успешная регистрация, открытие на чтение файла, ошибки.</p></li>
<li><p>Исключить из описания события часто повторяющиеся слова, что существенно упростит поиск нужной информации в будущем.</p></li>
<li><p>Добавлять к логам теги: переходя по ним, вы сможете находить данные, даже если они находятся в разных категориях. Теги могут относиться как бизнес-логике (ПРОДАЖА, РЕГИСТРАЦИЯ), так и внутренним процессам в коде (ПОДКЛЮЧЕНИЕ_К_БД, ЧТЕНИЕ_ФАЙЛА), и любые другие осмысленные варианты.</p></li>
<li><p>Использовать только нужную информацию: лишние сведения будут только засорять логи и делать работу с ними медленнее даже при автоматической обработке событий.</p></li>
<li><p>Использовать типы и уровни логирования осознанно. Это упрощает использование журнала логов для последующей аналитики и визуализации.</p></li>
</ul>
<p>Следуя этим основам грамотного ведения журнала программного обеспечения, можно гарантировать, что данные журнала собираются так, чтобы облегчать отладку и мониторинг вашего ПО.</p>
</section>
<section id="python">
<h2>Библиотеки логирования для языка программирования Python<a class="headerlink" href="#python" title="Link to this heading">¶</a></h2>
<p>Существует несколько популярных библиотек ведения журнала для Python:</p>
<section id="logging">
<h3><a class="reference external" href="https://docs.python.org/3/library/logging.html"><strong>logging</strong></a><a class="headerlink" href="#logging" title="Link to this heading">¶</a></h3>
<p>Встроенный модуль ведения журнала в стандартной библиотеке Python — это гибкая и мощная библиотека ведения логов, которая предоставляет множество функциональных возможностей «из коробки».</p>
<p>(<a class="reference download internal" download="" href="../../_downloads/bdd5254eb7235f9ac020843bd22eacc4/logging_sample.py"><span class="xref download myst">код</span></a>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">logging.handlers</span> <span class="kn">import</span> <span class="n">TimedRotatingFileHandler</span>

<span class="n">FORMATTER_STRING</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> — </span><span class="si">%(name)s</span><span class="s2"> — </span><span class="si">%(levelname)s</span><span class="s2"> — </span><span class="si">%(message)s</span><span class="s2">&quot;</span>
<span class="n">FORMATTER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="n">FORMATTER_STRING</span><span class="p">)</span>
<span class="n">LOG_FILE</span> <span class="o">=</span> <span class="s2">&quot;/tmp/my_app.log&quot;</span> <span class="c1"># use fancy libs to make proper temp file</span>

<span class="k">def</span> <span class="nf">get_logger</span><span class="p">(</span><span class="n">logger_name</span><span class="p">):</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">logger_name</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
    
    <span class="n">console_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="n">console_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">FORMATTER</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">console_handler</span><span class="p">)</span>

    <span class="n">file_handler</span> <span class="o">=</span> <span class="n">TimedRotatingFileHandler</span><span class="p">(</span><span class="n">LOG_FILE</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="s1">&#39;midnight&#39;</span><span class="p">)</span>
    <span class="c1">#file_handler.setFormatter(FORMATTER)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">file_handler</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">logger</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;my_app_logger&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Start logging&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Some debug message&quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span> 
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Keep logging&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s2">&quot;User get bored&quot;</span><span class="p">)</span>
            <span class="k">break</span>
</pre></div>
</div>
<p>Давайте поймем, что здесь происходит. Мы создаем логгер и выводим логи на уровне INFO в файл и в терминал. В файле логи записываются без форматирования. Выводим сообщение о критической ошибке, когда пользователь нажмет Ctrl-C и прервет выполнение программы. Обратите внимание, что сообщения уровня DEBUG не выводятся, так как мы установили уровень для вывода не ниже INFO <code class="docutils literal notranslate"><span class="pre">logger.setLevel(logging.INFO)</span></code>. Ниже описаны объекты, которые мы используем в коде:</p>
<ul class="simple">
<li><p>FORMATTER — определяет, как будет выглядеть строка события в логах. В него мы передаем шаблон, который хотим реализовать.</p></li>
<li><p>LOG_FILE — определяет, в какой файл мы будем писать логи. По умолчанию мы выводим в стандартный вывод stderr, и если хотим видеть логи на экране и сохранять в файл, должны явно это указать.</p></li>
<li><p>get_logger() — создает объект класса Logger, который мы будем использовать для логирования.</p></li>
<li><p>console_handler — обработчик вывода в терминал, по умолчанию используется stderr, поэтому явно говорим, что хотим видеть сообщения в stdout.</p></li>
<li><p>file_handler — обработчик вывода логов в файл, обратите внимания, что мы закомментировали форматирование, поэтому сообщения будут записаны в стандартной форме.</p></li>
<li><p>logger.info() — используем для вывода логов на уровне INFO. Другие уровни имеют соответствующие функции для вывода.</p></li>
</ul>
<p>Запустим приложение и увидим вывод:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>artem@pc:~$<span class="w"> </span>python<span class="w"> </span>./logging_sample.py
<span class="w">    </span><span class="m">2023</span>-02-14<span class="w"> </span><span class="m">10</span>:05:40,074<span class="w"> </span>—<span class="w"> </span>my_app_logger<span class="w"> </span>—<span class="w"> </span>INFO<span class="w"> </span>—<span class="w"> </span>Start<span class="w"> </span>logging
<span class="w">    </span><span class="m">2023</span>-02-14<span class="w"> </span><span class="m">10</span>:05:41,075<span class="w"> </span>—<span class="w"> </span>my_app_logger<span class="w"> </span>—<span class="w"> </span>INFO<span class="w"> </span>—<span class="w"> </span>Keep<span class="w"> </span>logging
<span class="w">    </span><span class="m">2023</span>-02-14<span class="w"> </span><span class="m">10</span>:05:42,076<span class="w"> </span>—<span class="w"> </span>my_app_logger<span class="w"> </span>—<span class="w"> </span>INFO<span class="w"> </span>—<span class="w"> </span>Keep<span class="w"> </span>logging
<span class="w">    </span>^C2023-02-14<span class="w"> </span><span class="m">10</span>:05:42,392<span class="w"> </span>—<span class="w"> </span>my_app_logger<span class="w"> </span>—<span class="w"> </span>CRITICAL<span class="w"> </span>—<span class="w"> </span>User<span class="w"> </span>get<span class="w"> </span>bored
</pre></div>
</div>
<p>В файле мы видим те же самые сообщения, но не снабженные никакой дополнительной информацией:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>artem@pc:~$<span class="w"> </span>cat<span class="w"> </span>/tmp/my_app.log
<span class="w">    </span>Start<span class="w"> </span>logging
<span class="w">    </span>Keep<span class="w"> </span>logging
<span class="w">    </span>Keep<span class="w"> </span>logging
<span class="w">    </span>User<span class="w"> </span>get<span class="w"> </span>bored
</pre></div>
</div>
</section>
<section id="structlog">
<h3><a class="reference external" href="https://www.structlog.org/en/stable/"><strong>structlog</strong></a><a class="headerlink" href="#structlog" title="Link to this heading">¶</a></h3>
<p>Это библиотека расширяет встроенный модуль Python для ведения логов с дополнительными функциями, такими как возможность прикреплять дополнительные данные к сообщениям или манипулировать сообщениями до их отправки.</p>
<p>Рассмотрим слегка модифицированный пример с сайта <code class="docutils literal notranslate"><span class="pre">structlog</span></code>:</p>
<p>(<a class="reference download internal" download="" href="../../_downloads/efc247b4b74204afb9a04f878363c935/structlog_sample.py"><span class="xref download myst">код</span></a>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">structlog</span>

<span class="n">FORMATTER_STRING</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> — </span><span class="si">%(name)s</span><span class="s2"> — </span><span class="si">%(levelname)s</span><span class="s2"> — </span><span class="si">%(message)s</span><span class="s2">&quot;</span>
<span class="n">FORMATTER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="n">FORMATTER_STRING</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_logger</span><span class="p">(</span><span class="n">logger_name</span><span class="p">):</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">logger_name</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>    
    <span class="n">console_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="n">console_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">FORMATTER</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">console_handler</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">logger</span>

<span class="k">def</span> <span class="nf">replace_user</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">event_dict</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">event_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
        <span class="c1"># we can access data base here for user_token</span>
        <span class="c1"># for now keep it fake</span>
        <span class="n">user_token</span> <span class="o">=</span> <span class="s2">&quot;some_string_that_we_can_learn_username_from&quot;</span>
        <span class="n">event_dict</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_token</span>
    <span class="k">return</span> <span class="n">event_dict</span>

<span class="k">def</span> <span class="nf">censor_password</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">event_dict</span><span class="p">):</span>
    <span class="n">pw</span> <span class="o">=</span> <span class="n">event_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pw</span><span class="p">:</span>
        <span class="n">event_dict</span><span class="p">[</span><span class="s2">&quot;password&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;*CENSORED*&quot;</span>
    <span class="k">return</span> <span class="n">event_dict</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">structlog</span><span class="o">.</span><span class="n">wrap_logger</span><span class="p">(</span>
    <span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;my_app_logger&quot;</span><span class="p">),</span>
    <span class="n">processors</span><span class="o">=</span><span class="p">[</span>
        <span class="n">censor_password</span><span class="p">,</span>
        <span class="n">replace_user</span><span class="p">,</span>
        <span class="n">structlog</span><span class="o">.</span><span class="n">processors</span><span class="o">.</span><span class="n">JSONRenderer</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;something&quot;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&quot;secret&quot;</span><span class="p">)</span>
<span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;something&quot;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s2">&quot;Ivan&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Здесь мы используем <code class="docutils literal notranslate"><span class="pre">get_logger()</span></code> как раньше. Убрали вывод в файл, так как он не важен для демонстрации. Сделали обертку для логгера и определили, что должно происходить с данными, если они передаются для логирования. Мы видим, что здесь нам необязательно определять строку форматирования для всех данных, данные передаются по ключам, и это дает нам возможность получить читаемый вывод и сделать что-нибудь со значениями до вывода. В примере ниже мы хотим заменить имена на что-то, что позволит нам восстановить эти имена, например, если мы держим соответствие имен и некоторых токенов (если требования к личным данным не позволяют нам публиковать имена людей). Пароли мы хотим скрыть полностью. Для манипуляции с данными в логгер от <code class="docutils literal notranslate"><span class="pre">structlog</span></code> мы можем определить несколько <em>обработчиков (processors)</em>, в которых описано то, что мы хотим сделать.</p>
<ul class="simple">
<li><p>censor_password — функция-обработчик, которая скроет пароль, если он присутствует в данных, заменив на <code class="docutils literal notranslate"><span class="pre">*CENSORED*</span></code>.</p></li>
<li><p>replace_user — функция-обработчик, которая заменит имя пользователя.</p></li>
</ul>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="m">2023</span>-02-14<span class="w"> </span><span class="m">10</span>:53:42,214<span class="w"> </span>—<span class="w"> </span>my_app_logger<span class="w"> </span>—<span class="w"> </span>WARNING<span class="w"> </span>—<span class="w"> </span><span class="o">{</span>
<span class="w"> </span><span class="s2">&quot;event&quot;</span>:<span class="w"> </span><span class="s2">&quot;something&quot;</span>,
<span class="w"> </span><span class="s2">&quot;password&quot;</span>:<span class="w"> </span><span class="s2">&quot;*CENSORED*&quot;</span>
<span class="o">}</span>
<span class="m">2023</span>-02-14<span class="w"> </span><span class="m">10</span>:53:42,214<span class="w"> </span>—<span class="w"> </span>my_app_logger<span class="w"> </span>—<span class="w"> </span>WARNING<span class="w"> </span>—<span class="w"> </span><span class="o">{</span>
<span class="w"> </span><span class="s2">&quot;event&quot;</span>:<span class="w"> </span><span class="s2">&quot;something&quot;</span>,
<span class="w"> </span><span class="s2">&quot;user&quot;</span>:<span class="w"> </span><span class="s2">&quot;some_string_that_we_can_learn_username_from&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
</section>
<section id="loguru">
<h3><a class="reference external" href="https://github.com/Delgan/loguru"><strong>loguru</strong></a><a class="headerlink" href="#loguru" title="Link to this heading">¶</a></h3>
<p>Эта библиотека сделает ваш журнал более простым в использовании. Loguru предоставляет простой и интуитивно понятный интерфейс для протоколирования сообщений и поддерживает расширенные функции, такие как фильтрация журналов, цветной вывод и обработка исключений.</p>
<p>Пример из <a class="reference external" href="https://medium.com/analytics-vidhya/a-quick-guide-to-using-loguru-4042dc5437a5">статьи</a> позволяет понять возможность <code class="docutils literal notranslate"><span class="pre">loguru</span></code>:</p>
<p>(<a class="reference download internal" download="" href="../../_downloads/2cc4ced6ba1f39223813989a7a9239ad/loguru_sample.py"><span class="xref download myst">код</span></a>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">loguru</span> <span class="kn">import</span> <span class="n">logger</span>

<span class="n">logger</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">backtrace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">diagnose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="n">func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">nested</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">func</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Division by zero error!&quot;</span><span class="p">)</span>

<span class="n">nested</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>При запуске мы получим такой вывод:</p>
<p><img alt="loguru_output" src="../../_images/loguru_output.png" /></p>
</section>
<section id="logbook">
<h3><a class="reference external" href="https://logbook.readthedocs.io/en/stable/"><strong>logbook</strong></a><a class="headerlink" href="#logbook" title="Link to this heading">¶</a></h3>
<p>Это библиотека ведения логов, которая разработана таким образом, чтобы быть быстрой и эффективной, и предоставляет такие функции, как ведение логов с учетом контекста, гибкое форматирование журнала и поддержка различных уровней ведения журнала.</p>
<p>Как видно, все библиотеки имеют почти одинаковый функционал. Лучшая библиотека ведения журнала для вашего проекта будет зависеть от ваших конкретных потребностей.</p>
</section>
</section>
<section id="id6">
<h2>Централизация логов<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h2>
<p>Централизация логов относится к практике сбора данных журнала из нескольких источников и хранения их в центральном хранилище. Это облегчает управление всей информацией и ее отслеживание, так что вы можете использовать ее для решения проблем и убедиться, что все работает правильно. Наличие всех логов в одном месте также повышает безопасность и помогает уберечь информацию от потери. И это также может ускорить и упростить поиск и устранение проблем, потому что вам не нужно просматривать информацию из множества разных мест.</p>
<p>Существуют различные способы централизации логов, но цель всегда состоит в том, чтобы иметь всю информацию в одном месте, к которому легко получить доступ и которым можно пользоваться.</p>
<p>Существует несколько способов централизации логов, включая использование централизованных систем ведения журнала, таких как Elastic Stack, Logstash или Graylog, или с помощью облачных служб ведения журнала, таких как Google Stackdriver. Наилучший подход к централизации данных журнала будет зависеть от конкретных потребностей.</p>
<p>Мы советуем обратить внимание на стек ELK для централизации логов.</p>
</section>
<section id="id7">
<h2>Вывод<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h2>
<p>Подведем итог: ведение логов является важнейшим компонентом разработки и эксплуатации программного обеспечения, которое дает ценную информацию. Логирование дает возможность быстро находить проблемы и их источники, устранять их, выявлять конфликты в конфигурационных файлах и следить за безопасностью.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">toolchain</a></h1>








<h3>Навигация</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../terms/content.html">Терминология</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../bash/content.html">Работа в командной строке</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bash/exercises.html">Задачи</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bash/quiz.html">Вопросы</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../git_base/content.html">Git</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../team_work_on_a_project/content.html">Git как инструмент командной работы. Работа с удаленными репозиториями.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../team_work_on_a_project/exercises.html">Задача: Планирование и организация работы над разработкой чат-бота с использованием Канбан доски</a></li>
<li class="toctree-l1"><a class="reference internal" href="../team_work_on_a_project/quiz.html">Вопросы</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../team_work_on_a_gitflic/content.html">Знакомство с платформами размещения исходного кода программ на примере Gitflick</a></li>
<li class="toctree-l1"><a class="reference internal" href="../team_work_on_a_gitflic/exercises.html">Задание для команды разработчиков: Создание чат-бота для мессенджера Telegram с использованием GitFlick</a></li>
<li class="toctree-l1"><a class="reference internal" href="../team_work_on_a_gitflic/quiz.html">Вопросы</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ide/content.html">Среда разработки</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../styles/content.html">Оформление кода</a></li>
<li class="toctree-l1"><a class="reference internal" href="../styles/exercises.html">Задачи</a></li>
<li class="toctree-l1"><a class="reference internal" href="../styles/quiz.html">Вопросы</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../github/content.html">Сервис GitHub</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../stages/content.html">Стадии жизни проекта</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mvp/content.html">Работа над MVP</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../uml/content.html">Факультатив. Стандартные графические схемы при разработке ПО</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uml/exercises.html">Задачи</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uml/quiz.html">Вопросы</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../code_to_lib/content.html">Код -&gt; Библиотека</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code_to_lib/exercises.html">Задачи</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code_to_lib/quiz.html">Вопросы</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../open_source/content.html">Основы Open Source, базовые определения и принципы устройства</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../open_license/content.html">Лицензии Open Source</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../github_pages/content.html">Github Pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../github_pages/exercises.html">Задачи</a></li>
<li class="toctree-l1"><a class="reference internal" href="../github_pages/quiz.html">Вопросы</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../path_venv/content.html">Знакомство с рабочим окружением</a></li>
<li class="toctree-l1"><a class="reference internal" href="../path_venv/exercises.html">Задачи для практики</a></li>
<li class="toctree-l1"><a class="reference internal" href="../path_venv/quiz.html">Вопросы:</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../docs/content.html">Документирование</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/exercises.html">Задачи</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/quiz.html">Вопросы</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../testing/content.html">Тестирование</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/exercises.html">Задачи:</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/quiz.html">Вопросы</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Логирование. Что это и в чем его польза?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id2">Мотивация</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">Зачем нужно логирование?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4">Уровни логирования</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">Основы грамотного логирования</a></li>
<li class="toctree-l2"><a class="reference internal" href="#python">Библиотеки логирования для языка программирования Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id6">Централизация логов</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id7">Вывод</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="exercises.html">Задача</a></li>
<li class="toctree-l1"><a class="reference internal" href="quiz.html">Вопросы</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../packaging/content.html">Менеджеры пакетов</a></li>
<li class="toctree-l1"><a class="reference internal" href="../packaging/exercises.html">Задачи</a></li>
<li class="toctree-l1"><a class="reference internal" href="../packaging/quiz.html">Вопросы</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../managers/content.html">Менеджеры и планировщики</a></li>
<li class="toctree-l1"><a class="reference internal" href="../managers/exercises.html">Задачи</a></li>
<li class="toctree-l1"><a class="reference internal" href="../managers/quiz.html">Вопросы</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../docker_base/content.html">Контейнеризация на примере Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docker_base/exercises.html">Практическое задание 1: Развертывание Python кода в Docker контейнере</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docker_base/quiz.html">Вопросы</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../docker_network/content.html">Концепция сети в Docker</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../docker_hub/content.html">Реестр Docker</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../testing/quiz.html" title="предыдущая глава">Вопросы</a></li>
      <li>Next: <a href="exercises.html" title="следующая глава">Задача</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Быстрый поиск</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Искать" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2023, Artem Vesnin.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../../_sources/educational_materials/logging/content.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>