<!DOCTYPE html>

<html lang="ru" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Менеджеры и планировщики &#8212; документация toolchain 1.0</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=12dfc556" />
    <script src="../../_static/documentation_options.js?v=9ca2116e"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/translations.js?v=29b1f277"></script>
    <link rel="index" title="Алфавитный указатель" href="../../genindex.html" />
    <link rel="search" title="Поиск" href="../../search.html" />
    <link rel="next" title="Задачи" href="exercises.html" />
    <link rel="prev" title="Вопросы" href="../packaging/quiz.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="id1">
<h1>Менеджеры и планировщики<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h1>
<p>В данном уроке речь пойдет о менеджерах и планировщиках заданий. Они используются для того, чтобы запустить программы, которые написаны нами по расписанию (планировщики), и контролировать запуск/перезапуск приложений-сервисов (менеджеры).</p>
<section id="id2">
<h2>Мотивация<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<p>Бывает множество случаев, когда нам нужно делать что-то периодически или обеспечить надежную работу приложений. Задачей, которую можно отнести к периодической, является мониторинг состояния жестких дисков, одной из наименее надежных частей компьютера, и отправка информации пользователю компьютера или системному администратору, если есть вероятность поломки. Задачей, которую можно отнести ко второму типу, является запуск приложения в виде сервиса, который должен быть доступен всегда для других приложений или пользователей, и если сервис «упал», менеджер сервисов должен попытаться перезапустить его.</p>
<p>Планировщик задач можно сравнить с тренером на групповой тренировке, он говорит, что делать в определенные моменты времени, но проследить за правильностью выполнения каждым участником тренировки не может. Так, он запустит задачу, но если она завершится с ошибкой, то это будет не зона ответственности планировщика, а зона ответственность разработчика.</p>
<p>Менеджер сервисов больше похож на индивидуального тренер, который заинтересован не только в запуске задач, но и в отслеживании их правильного выполнения. При этом менеджер сервисов не берет на себя  достижение правильного поведения приложения, это по-прежнему задача разработчика, но менеджер сервисов может предоставить разработчику инструменты для того, чтобы облегчить запуск (например, только после того как мы подключимся к интернету) и поиск ошибок (например, с помощью журнала логов).</p>
</section>
<section id="crontab">
<h2>Планировщик crontab<a class="headerlink" href="#crontab" title="Link to this heading">¶</a></h2>
<p>В качестве примера планировщика мы будем рассматривать <code class="docutils literal notranslate"><span class="pre">crontab</span></code>. Crontab — это утилита-планировщик командной строки в операционных системах Linux, название означает <code class="docutils literal notranslate"><span class="pre">cron</span> <span class="pre">table</span></code>. Он используется для создания, управления и поддержки списка запланированных задач, известных как <code class="docutils literal notranslate"><span class="pre">cron</span> <span class="pre">jobs</span></code>. Задания cron — это автоматизированные задачи, которые выполняются через определенные промежутки времени или в определенное время, не требуя ручного вмешательства. Crontab позволяет пользователям планировать выполнение задач в определенные моменты времени, что делает его мощным инструментом для автоматизации повторяющихся или периодических действий в системе Linux.</p>
<p>Ключевые понятия <code class="docutils literal notranslate"><span class="pre">crontab</span></code>:</p>
<ul class="simple">
<li><p>cron job — это отдельная задача или команда, выполнение которой запланировано через определенные промежутки времени. Каждое задание cron определяется как отдельная строка в файле crontab, т.е. в таблице заданий <code class="docutils literal notranslate"><span class="pre">cron</span> <span class="pre">table</span></code>.</p></li>
<li><p>расписание — это таблица, которая определяет, когда будет выполняться задание cron. Формат расписания состоит из пяти полей, представляющих минуты, часы, день месяца, месяц и день недели соответственно. Каждое поле использует определенный синтаксис для определения расписания. Пять звездочек в примере ниже представляют расписание для каждой минуты, каждого часа, каждого дня месяца, каждого месяца и каждого дня недели, <code class="docutils literal notranslate"><span class="pre">command_to_run</span></code> — это задача, который нужно выполнить. Таким образом, <code class="docutils literal notranslate"><span class="pre">command_to_run</span></code> будет выполняться каждую минуту без исключений.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="n">command_to_run</span>
</pre></div>
</div>
<ul class="simple">
<li><p>спецификаторы времени. Вместо использования звездочек для всех полей вы можете указать определенные значения или диапазоны для точной настройки расписания. Например:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="mi">0</span> <span class="mi">3</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="n">job</span>          <span class="n">запускает</span> <span class="n">команду</span> <span class="n">ежедневно</span> <span class="n">в</span> <span class="mi">3</span><span class="p">:</span><span class="mf">00.</span>
    <span class="o">*/</span><span class="mi">5</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="n">job</span>        <span class="n">будет</span> <span class="n">запускать</span> <span class="n">команду</span> <span class="n">каждые</span> <span class="n">пять</span> <span class="n">минут</span><span class="o">.</span>
    <span class="o">*</span> <span class="o">*</span> <span class="o">*/</span><span class="mi">5</span> <span class="o">*</span> <span class="o">*</span> <span class="n">job</span>        <span class="n">будет</span> <span class="n">запускать</span> <span class="n">команду</span> <span class="n">каждую</span> <span class="n">минуту</span> <span class="n">пятого</span> <span class="n">числа</span> <span class="n">каждого</span> <span class="n">месяца</span><span class="o">.</span>
    <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="mi">1</span><span class="p">,</span><span class="mi">4</span> <span class="n">job</span>        <span class="n">будет</span> <span class="n">запускать</span> <span class="n">команду</span> <span class="n">каждую</span> <span class="n">минуту</span> <span class="n">в</span> <span class="n">понедельник</span> <span class="n">и</span> <span class="n">четверг</span><span class="o">.</span>
    <span class="mi">15</span> <span class="mi">1</span><span class="o">-</span><span class="mi">5</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="n">job</span>        <span class="n">будет</span> <span class="n">запускать</span> <span class="n">команду</span> <span class="n">в</span> <span class="mi">15</span> <span class="n">минут</span> <span class="n">каждого</span> <span class="n">часа</span> <span class="n">с</span> <span class="mi">01</span><span class="p">:</span><span class="mi">00</span> <span class="n">по</span> <span class="mi">05</span><span class="p">:</span><span class="mf">00.</span>
</pre></div>
</div>
<ul class="simple">
<li><p>user-specific crontab. Каждый пользователь в системе может иметь свой собственный crontab, который управляется независимо. crontab текущего пользователя можно редактировать с помощью команды <code class="docutils literal notranslate"><span class="pre">crontab</span> <span class="pre">-e</span></code>, выполненной в <code class="docutils literal notranslate"><span class="pre">bash</span></code>.</p></li>
<li><p>system-wide crontab. Помимо пользовательских crontab, существует также общесистемный crontab, который позволяет системным администраторам планировать задачи, влияющие на всю систему и всех пользователей.</p></li>
</ul>
<p>Пользоваться <code class="docutils literal notranslate"><span class="pre">crontab</span></code> очень легко, просто наберите в командной строке Linux <code class="docutils literal notranslate"><span class="pre">crontab</span> <span class="pre">-e</span></code>:</p>
<p><img alt="crontab_e" src="../../_images/corntab_e.png" /></p>
<p>После этого откроется расписание задач, которое можно будет поправить как нужно.</p>
<p><img alt="crontab_schedule" src="../../_images/crontab_schedule.png" /></p>
<p>По умолчанию <code class="docutils literal notranslate"><span class="pre">crontab</span></code> не будет будет логировать вывод вашего приложения (это не касается того, что вы сами используете внутри кода, например, с помощью loguru). Для того чтобы записать вывод вашего приложения, можно использовать синтаксис, подобный примеру ниже.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">command</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">logfile</span><span class="o">.</span><span class="n">log</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span>
</pre></div>
</div>
<p>Если мы вспомним урок про <code class="docutils literal notranslate"><span class="pre">bash</span></code>, то не найдем ничего нового: <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span> <span class="pre">/path/to/logfile.log</span></code> перенаправляет стандартный поток <code class="docutils literal notranslate"><span class="pre">stdout</span></code> в файл, а <code class="docutils literal notranslate"><span class="pre">2&gt;&amp;1</span></code> перенаправляет ошибки <code class="docutils literal notranslate"><span class="pre">stderr</span></code> в <code class="docutils literal notranslate"><span class="pre">stdout</span></code>, таким образом, мы запишем и ошибки, и простые сообщения.</p>
<p>Типичные варианты использования crontab:</p>
<ul class="simple">
<li><p>Автоматическое резервное копирование: запланируйте регулярное резервное копирование важных данных, чтобы обеспечить безопасность данных и варианты восстановления. Большие программы, скорее всего, будут иметь встроенный механизм для обеспечения резервного копирования, но <code class="docutils literal notranslate"><span class="pre">crontab</span></code> — это универсальный способ, который можно использовать для любой задачи, в том числе для своих проектов.</p></li>
<li><p>Обслуживание системы: автоматизируйте рутинные задачи по обслуживанию системы, такие как очистка временных файлов, оптимизация баз данных, зеркалирование данных (например, ночью, когда нет нагрузки на сеть со стороны пользователей) и так далее.</p></li>
<li><p>Периодические отчеты: создавайте и отправляйте по электронной почте или в чат-боте периодические отчеты, содержащие информацию о состоянии системы или статистику использования.</p></li>
<li><p>Выполнение сценариев по расписанию: запуск пользовательских сценариев через определенные промежутки времени для различных целей.</p></li>
</ul>
<section id="id3">
<h3>Практическое применение crontab<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h3>
<p>Рассмотрим скрипт, которые собирает информацию о месте на диске, которое занимает содержимое директории, и сохраняет эту информацию вместе с временем обращения к директории в файл. Настроим <code class="docutils literal notranslate"><span class="pre">crontab</span></code> так, чтобы наш скрипт запускался каждые 5 секунд. Мы будем использовать <code class="docutils literal notranslate"><span class="pre">bash</span></code> для написания скрипта, но вы можете написать скрипт на любом языке программирования.</p>
<p>Файл скрипта <code class="docutils literal notranslate"><span class="pre">collect_dir_space.sh</span></code> будет выглядеть следующим образом:</p>
<p>(<a class="reference download internal" download="" href="../../_downloads/7e389d42718e3e1069b4a42ced5f59af/collect_dir_space.sh"><span class="xref download myst">код</span></a>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nv">target_directory</span><span class="o">=</span><span class="s2">&quot;/tmp/monitored_directory&quot;</span>

<span class="nv">log_file</span><span class="o">=</span><span class="s2">&quot;/tmp/dir_space.log&quot;</span>

<span class="c1"># Collect disk space occupied by the target directory</span>
<span class="nv">disk_space</span><span class="o">=</span><span class="k">$(</span>du<span class="w"> </span>-sh<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target_directory</span><span class="s2">&quot;</span><span class="k">)</span>

<span class="nv">current_date</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+<span class="s2">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="k">)</span>

<span class="c1"># Log the disk space information with the current date</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$current_date</span><span class="s2"> - Disk Space Usage: </span><span class="nv">$disk_space</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$log_file</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>Теперь нужно создать директорию, которую нужно мониторить, и сделать так, чтобы скрипт можно было запускать.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>/tmp/monitored_directory
sudo<span class="w"> </span>chmod<span class="w"> </span>+x<span class="w"> </span>collect_dir_space.sh
</pre></div>
</div>
<p>И добавим следующую строку в <code class="docutils literal notranslate"><span class="pre">crontab</span></code>, для этого выполним команду <code class="docutils literal notranslate"><span class="pre">crontab</span> <span class="pre">-e</span></code> (см. выше на скриншоте).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>/path/to/collect_dir_space.sh
</pre></div>
</div>
<p><img alt="crontab_job_installed" src="../../_images/crontab_job_installed.png" /></p>
<p>И проверим, что все работает:</p>
<p><img alt="crontab_job_works" src="../../_images/crontab_job_works.png" /></p>
<p>Мы видим, что в файл <code class="docutils literal notranslate"><span class="pre">/tmp/dir_space.log</span></code> добавляется информация о дисковом пространстве, занятом файлами в директории. Между вызовами <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/tmp/dir_space.log</span></code> мы скопировали файл <code class="docutils literal notranslate"><span class="pre">a.png</span></code>, который занимает пример 282 кБ.</p>
</section>
</section>
<section id="systemctl">
<h2>Менеджер systemctl<a class="headerlink" href="#systemctl" title="Link to this heading">¶</a></h2>
<p>Мы будем рассматривать <code class="docutils literal notranslate"><span class="pre">systemctl</span></code> — это утилита командной строки, используемая в современных дистрибутивах Linux, которые используют систему инициализации <code class="docutils literal notranslate"><span class="pre">systemd</span></code> (отвечает за загрузку системы, управление системными службами/демонами, отслеживание состояния системы и обработку отключений системы.). Хотя <code class="docutils literal notranslate"><span class="pre">systemd</span></code> и <code class="docutils literal notranslate"><span class="pre">systemctl</span></code> связаны, это не одно и тоже. Для целей освоения этого урока можно считать, что <code class="docutils literal notranslate"><span class="pre">systemctl</span></code> предоставляет интерфейс <code class="docutils literal notranslate"><span class="pre">systemd</span></code>, который уже отвечает за запуск приложений. <em>Примечание: правильнее было бы назвать менеджером systemd, но так как мы будем использовать его с помощью systemctl, мы позволили себе такую подмену понятий</em>.</p>
<p>Он обеспечивает контроль над системными службами, демонами и другими модулями, позволяя пользователям управлять состоянием и поведением системы. Systemd — это система инициализации по умолчанию во многих дистрибутивах Linux, заменяющая традиционную систему инициализации SysV.</p>
<p>Ключевым элементом при работе с systemctl является Unit. Unit’ы могут быть нескольких типов: службы, сокеты, таймеры, точки монтирования и другие системные ресурсы. Каждый unit определяется файлом c конфигурацией, который предоставляет информацию о том, как запускать, останавливать, включать, отключать выполняемую команду и как управляется unit. Например, unit может быть постоянно включен и перезагружаться при падении или стартовать по расписанию (похоже на то, как это делает crontab).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>* Ниже приведен пример конфигурации для службы/сервиса/демона, т.е. приложения, которое работает в фоне. Большинство строк можно понять интуитивно. `Description` описывает то, что делает приложение. `After` описывает зависимость, т.е. от чего зависит текущая служба, в примере ниже, мы ждем, пока не &quot;поднимется&quot; сеть. `ExecStart` описывает команду/программу, которая будет запущена. `Restart` описывает, когда нам нужно перезапустить службу, если она упала. [WantedBy](https://unix.stackexchange.com/questions/506347/why-do-most-systemd-examples-contain-wantedby-multi-user-target) и [Type](https://superuser.com/questions/1274901/systemd-forking-vs-simple) определяют состояние операционной системы и различные сценарии использования службы, для целей данного урока они не являются принципиальными, но вы можете изучить их самостоятельно.
</pre></div>
</div>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="w">            </span><span class="k">[Unit]</span>
<span class="w">            </span><span class="na">Description</span><span class="o">=</span><span class="s">My Application Service</span>
<span class="w">            </span><span class="na">After</span><span class="o">=</span><span class="s">network.target</span>
<span class="w">            </span>
<span class="w">            </span><span class="k">[Service]</span>
<span class="w">            </span><span class="na">Type</span><span class="o">=</span><span class="s">simple</span>
<span class="w">            </span><span class="na">ExecStart</span><span class="o">=</span><span class="s">python /path/to/my_script.py param1 param2</span>
<span class="w">            </span><span class="na">Restart</span><span class="o">=</span><span class="s">always</span>
<span class="w">            </span>
<span class="w">            </span><span class="k">[Install]</span>
<span class="w">            </span><span class="na">WantedBy</span><span class="o">=</span><span class="s">multi-user.target</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>* Ниже приведен пример unit timer, который можно считать заменой `crontab`, но более сложной в конфигурировании. Мы создадим сервис с типом `Type=oneshot` что говорит systemd запустить его лишь один раз, и потом создадим таймер, который будет вызывать сервис по расписанию.
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>            <span class="c1"># Service that executed once when called; file my_service.service</span>
            <span class="p">[</span><span class="n">Unit</span><span class="p">]</span>
            <span class="n">Description</span><span class="o">=</span><span class="n">My</span> <span class="n">Task</span>
            
            <span class="p">[</span><span class="n">Service</span><span class="p">]</span>
            <span class="n">Type</span><span class="o">=</span><span class="n">oneshot</span>
            <span class="n">ExecStart</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">your</span><span class="o">/</span><span class="n">script</span><span class="o">.</span><span class="n">sh</span>
            
            <span class="c1"># Timer to call service by schedule; file  my_service.timer</span>
            <span class="p">[</span><span class="n">Unit</span><span class="p">]</span>
            <span class="n">Description</span><span class="o">=</span><span class="n">Run</span> <span class="n">My</span> <span class="n">Task</span> <span class="n">Daily</span>
            
            <span class="p">[</span><span class="n">Timer</span><span class="p">]</span>
            <span class="n">OnCalendar</span><span class="o">=*-*-*</span> <span class="mi">03</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
            <span class="n">Persistent</span><span class="o">=</span><span class="n">true</span>
            
            <span class="p">[</span><span class="n">Install</span><span class="p">]</span>
            <span class="n">WantedBy</span><span class="o">=</span><span class="n">timers</span><span class="o">.</span><span class="n">target</span>
</pre></div>
</div>
<section id="id4">
<h3>Практическое применение systemctl<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h3>
<p>Еще одним интересным применением systemctl является мониторинг изменения файлов и отправка уведомлений. Ниже приведен пример сервиса, который будет логировать любую попытку изменения файла (также можно отправлять уведомления на почту или в мессенджер). Создадим файл для службы и сохраним его в файл с названием <code class="docutils literal notranslate"><span class="pre">pass_monitor.service</span></code> в домашней директории.</p>
<p>(<a class="reference download internal" download="" href="../../_downloads/ef4d85e766bbd4767cb71a723613cbb5/pass_monitor.service"><span class="xref download myst">код</span></a>):</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[Unit]</span><span class="w"> </span>
<span class="na">Description</span><span class="o">=</span><span class="s">&quot;Run script to log pass changed&quot;</span>

<span class="k">[Service]</span>
<span class="na">ExecStart</span><span class="o">=</span><span class="s">/bin/bash -c &quot;echo Changed &gt;&gt; /tmp/pass_change.log&quot;</span>

<span class="k">[Install]</span>
<span class="na">WantedBy</span><span class="o">=</span><span class="s">multi-user.target</span>
</pre></div>
</div>
<p>Теперь создадим <code class="docutils literal notranslate"><span class="pre">path</span> <span class="pre">unit</span></code>, который будет следит за файлом и вызывать наш сервис логирования. Создайте файл <code class="docutils literal notranslate"><span class="pre">pass_monitor.path</span></code> c содержимым.</p>
<p>(<a class="reference download internal" download="" href="../../_downloads/3b1d933ff43b221a9b552c650023fc1c/pass_monitor.path"><span class="xref download myst">код</span></a>):</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[Unit]</span>
<span class="na">Description</span><span class="o">=</span><span class="s">&quot;Monitor the /tmp/passwd file for changes&quot;</span>

<span class="k">[Path]</span>
<span class="na">PathModified</span><span class="o">=</span><span class="s">/tmp/passwd</span>
<span class="na">Unit</span><span class="o">=</span><span class="s">pass_monitor.service</span>

<span class="k">[Install]</span>
<span class="na">WantedBy</span><span class="o">=</span><span class="s">multi-user.target</span>
</pre></div>
</div>
<p>Активируем unit’ы:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>/home/artem/pass_monitor.service
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>/home/artem/pass_monitor.path
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>pass_monitor.path
</pre></div>
</div>
<p>Проверим, что все работает:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>pass_monitor.service
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>pass_monitor.path
</pre></div>
</div>
<p><img alt="service_unit_status" src="../../_images/service_unit_status.png" />
<img alt="path_unit_status" src="../../_images/path_unit_status.png" /></p>
<p>Убедимся, что все работает как задумано:</p>
<p><img alt="pass_change_log" src="../../_images/pass_change_log.png" /></p>
<p>Как мы видим из примера выше, даже при использовании Unit другого типа (Path, как в примере) нам все равно нужно создать Unit service, который будет управляться Unit’ом другого типа. Мы указывали его как <code class="docutils literal notranslate"><span class="pre">Unit=pass_monitor.service</span></code>.</p>
<p>С помощью systemctl вы можете запускать (<code class="docutils literal notranslate"><span class="pre">start</span></code>), останавливать (<code class="docutils literal notranslate"><span class="pre">stop</span></code>), перезапускать (<code class="docutils literal notranslate"><span class="pre">restart</span></code>), перезагружать (<code class="docutils literal notranslate"><span class="pre">reload</span></code>), включать (<code class="docutils literal notranslate"><span class="pre">enable</span></code>), отключать (<code class="docutils literal notranslate"><span class="pre">disable</span></code>) и проверять состояние (<code class="docutils literal notranslate"><span class="pre">status</span></code>).</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">enable</span></code>. Команда <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">enable</span> <span class="pre">my-service</span></code> используется для включения Unit. Можно рассматривать enable как функцию, которая регистрирует написанный нами Unit для systemd и включает автоматический запуск при загрузке или при выполнении условий его активации. После выполнения этой команды сервис можно запускать по имени без указания полного пути. Эта команда создает символическую ссылку на конфигурационный файл.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">disable</span></code>. Команда <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">disable</span> <span class="pre">my-service</span></code> используется для отключения Unit’а, предотвращая его автоматический запуск при загрузке или при выполнении условий его активации. Она удаляет символическую ссылку на Unit.</p></li>
<li><p>``. Команда <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">start</span> <span class="pre">my-service</span></code> запускает работу Unit’а <code class="docutils literal notranslate"><span class="pre">my-service</span></code>. Можно считать, что эта команда используется для ручного запуска Unit’а, например, для проверки работы или после устранения ошибки, которая не дает сервису работать в штатном режиме.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stop</span></code>. Команда <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">stop</span> <span class="pre">my-service</span></code> прекращает работу Unit’а <code class="docutils literal notranslate"><span class="pre">my-service</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">restart</span></code>. Команда <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">restrat</span> <span class="pre">my-service</span></code> прекращает и запускает работу Unit’а <code class="docutils literal notranslate"><span class="pre">my-service</span></code> заново.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reload</span></code>. Команда <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">reload</span> <span class="pre">my-service</span></code> используется для перезагрузки конфигурации работающего Unit’а без его остановки. Часто используется, когда службе необходимо принять изменения, внесенные в ее файл конфигурации, без полного перезапуска.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">status</span></code>. Команда <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">status</span> <span class="pre">my-service</span></code> предоставляет информацию о текущем состоянии Unit’а, например, работает служба, или она неактивна, сообщения об ошибках и время последнего запуска.</p></li>
</ul>
<p>Также удобным инструментом для отслеживания работы службы, в том числе в режиме реального времени, является <code class="docutils literal notranslate"><span class="pre">journalctl</span></code>. Его можно использовать как журнал событий, связанных с работой вашего приложения. При этом это универсальный инструмент для систем Linux, который не связан с определенным языком программирования. Он обладает не таким широким функционалом, и его вывод не оптимизирован под конкретный язык, как специализированные библиотеки, его использование в некоторых случаях может быть удобнее.</p>
<p><img alt="journalctl" src="../../_images/journalctl.png" /></p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">toolchain</a></h1>








<h3>Навигация</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../terms/content.html">Терминология</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../bash/content.html">Работа в командной строке</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bash/exercises.html">Задачи</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bash/quiz.html">Вопросы</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../git_base/content.html">Git</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../team_work_on_a_project/content.html">Git как инструмент командной работы. Работа с удаленными репозиториями.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../team_work_on_a_project/exercises.html">Задача: Планирование и организация работы над разработкой чат-бота с использованием Канбан доски</a></li>
<li class="toctree-l1"><a class="reference internal" href="../team_work_on_a_project/quiz.html">Вопросы</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../team_work_on_a_gitflic/content.html">Знакомство с платформами размещения исходного кода программ на примере Gitflick</a></li>
<li class="toctree-l1"><a class="reference internal" href="../team_work_on_a_gitflic/exercises.html">Задание для команды разработчиков: Создание чат-бота для мессенджера Telegram с использованием GitFlick</a></li>
<li class="toctree-l1"><a class="reference internal" href="../team_work_on_a_gitflic/quiz.html">Вопросы</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ide/content.html">Среда разработки</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../styles/content.html">Оформление кода</a></li>
<li class="toctree-l1"><a class="reference internal" href="../styles/exercises.html">Задачи</a></li>
<li class="toctree-l1"><a class="reference internal" href="../styles/quiz.html">Вопросы</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../github/content.html">Сервис GitHub</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../stages/content.html">Стадии жизни проекта</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mvp/content.html">Работа над MVP</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../uml/content.html">Факультатив. Стандартные графические схемы при разработке ПО</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uml/exercises.html">Задачи</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uml/quiz.html">Вопросы</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../code_to_lib/content.html">Код -&gt; Библиотека</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code_to_lib/exercises.html">Задачи</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code_to_lib/quiz.html">Вопросы</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../open_source/content.html">Основы Open Source, базовые определения и принципы устройства</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../open_license/content.html">Лицензии Open Source</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../github_pages/content.html">Github Pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../github_pages/exercises.html">Задачи</a></li>
<li class="toctree-l1"><a class="reference internal" href="../github_pages/quiz.html">Вопросы</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../path_venv/content.html">Знакомство с рабочим окружением</a></li>
<li class="toctree-l1"><a class="reference internal" href="../path_venv/exercises.html">Задачи для практики</a></li>
<li class="toctree-l1"><a class="reference internal" href="../path_venv/quiz.html">Вопросы:</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../docs/content.html">Документирование</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/exercises.html">Задачи</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/quiz.html">Вопросы</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../testing/content.html">Тестирование</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/exercises.html">Задачи:</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/quiz.html">Вопросы</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../logging/content.html">Логирование. Что это и в чем его польза?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logging/exercises.html">Задача</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logging/quiz.html">Вопросы</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../packaging/content.html">Менеджеры пакетов</a></li>
<li class="toctree-l1"><a class="reference internal" href="../packaging/exercises.html">Задачи</a></li>
<li class="toctree-l1"><a class="reference internal" href="../packaging/quiz.html">Вопросы</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Менеджеры и планировщики</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id2">Мотивация</a></li>
<li class="toctree-l2"><a class="reference internal" href="#crontab">Планировщик crontab</a></li>
<li class="toctree-l2"><a class="reference internal" href="#systemctl">Менеджер systemctl</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="exercises.html">Задачи</a></li>
<li class="toctree-l1"><a class="reference internal" href="quiz.html">Вопросы</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../docker_base/content.html">Контейнеризация на примере Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docker_base/exercises.html">Практическое задание 1: Развертывание Python кода в Docker контейнере</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docker_base/quiz.html">Вопросы</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../docker_network/content.html">Концепция сети в Docker</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../docker_hub/content.html">Реестр Docker</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../packaging/quiz.html" title="предыдущая глава">Вопросы</a></li>
      <li>Next: <a href="exercises.html" title="следующая глава">Задачи</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Быстрый поиск</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Искать" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2023, Artem Vesnin.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../../_sources/educational_materials/managers/content.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>